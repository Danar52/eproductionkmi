<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Form Input Produksi</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-accent: #007bff; /* A vibrant blue for primary actions */
      --secondary-action: #6c757d; /* A soft gray for secondary actions */
      --success-green: #28a745;
      --error-red: #dc3545;
      --warning-orange: #ffc107;
      --bg-light: #f8f9fa; /* Very light background */
      --card-bg: #ffffff;
      --text-dark: #343a40;
      --text-muted: #6c757d;
      --border-color: #e9ecef;
      --shadow-elevation-1: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
      --shadow-elevation-2: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
      --border-radius-pill: 50px;
      --border-radius-soft: 0.75rem;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: var(--bg-light);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 600px; /* Slightly wider container */
      background: var(--card-bg);
      padding: 40px;
      border-radius: var(--border-radius-soft);
      box-shadow: var(--shadow-elevation-2);
      animation: slideInUp 0.6s ease-out;
    }

    @keyframes slideInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      text-align: center;
      margin-bottom: 35px;
      color: var(--primary-accent);
      font-size: 2rem;
      font-weight: 700;
    }

    .form-group {
      margin-bottom: 25px;
      position: relative; /* For floating label effect */
    }

    label {
      position: absolute;
      top: 15px; /* Initial position */
      left: 15px;
      color: var(--text-muted);
      font-size: 1rem;
      pointer-events: none; /* Allows clicks to pass through to input */
      transition: all 0.2s ease-out;
      background-color: var(--card-bg); /* To cover input border when "floating" */
      padding: 0 5px;
      z-index: 1;
    }

    input:focus + label,
    select:focus + label,
    input:not(:placeholder-shown) + label,
    select:not(:placeholder-shown) + label,
    input.has-value + label, /* Added for pre-filled or readonly fields */
    select.has-value + label { /* Added for pre-filled or readonly fields */
      top: -10px; /* Floated position */
      left: 10px;
      font-size: 0.8rem;
      color: var(--primary-accent);
      font-weight: 500;
      z-index: 2; /* Bring label to front */
    }

    input, select {
      width: 100%;
      padding: 15px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-soft); /* Changed to soft for consistency */
      font-size: 1rem;
      color: var(--text-dark);
      background-color: var(--card-bg);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }

    select {
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%236c757d%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13.2-5.4H18.6c-5%200-9.3%201.8-13.2%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2013.2l128%20128c3.9%203.9%208.7%205.8%2013.2%205.8s9.3-1.9%2013.2-5.8l128-128c3.6-3.6%205.4-7.8%205.4-13.2s-1.8-9.3-5.4-13.2z%22%2F%3E%3C%2Fsvg%3E');
        background-repeat: no-repeat;
        background-position: right 15px center;
        background-size: 0.8em;
        padding-right: 40px;
    }

    input:focus, select:focus {
      border-color: var(--primary-accent);
      box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
      outline: none;
    }

    input[readonly] {
      background-color: var(--bg-light);
      color: var(--text-muted);
      cursor: not-allowed;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .button-group button,
    .button-group a {
      flex: 1;
      padding: 15px 20px;
      border: none;
      border-radius: var(--border-radius-soft); /* Changed to soft for consistency */
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      text-align: center;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-elevation-1);
    }

    .button-group i {
      margin-right: 10px;
      font-size: 1.1em;
    }

    .submit-btn {
      background-color: #12de00;
      color: var(--white);
    }

    .submit-btn:hover {
      background-color: #5ffb3f;
      transform: translateY(-2px);
      box-shadow: var(--shadow-elevation-2);
    }

    .dashboard-btn {
      background-color: var(--primary-accent);
      color: var(--white);
    }

    .dashboard-btn:hover {
      background-color: #63aeff;
      transform: translateY(-2px);
      box-shadow: var(--shadow-elevation-2);
    }

    /* --- Overlay and Spinner --- */
    #overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    #overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .spinner {
      width: 70px;
      height: 70px;
      border: 8px solid rgba(255,255,255,0.3);
      border-top: 8px solid var(--primary-accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* --- Pop-up Notification --- */
    .popup-notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--success-green);
      color: var(--white);
      padding: 15px 25px;
      border-radius: var(--border-radius-soft);
      box-shadow: var(--shadow-elevation-2);
      z-index: 10001;
      opacity: 0;
      visibility: hidden;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: slideInDown 0.5s ease-out forwards;
    }

    .popup-notification.show {
      opacity: 1;
      visibility: visible;
    }

    .popup-notification.hide {
      animation: slideOutUp 0.5s ease-in forwards;
    }

    /* Specific styling for error popup */
    .popup-notification.error {
        background-color: var(--error-red);
    }
    .popup-notification.error i {
        color: var(--white); /* Ensure icon color matches background */
    }


    @keyframes slideInDown {
      from { opacity: 0; transform: translate(-50%, -50px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }

    @keyframes slideOutUp {
      from { opacity: 1; transform: translate(-50%, 0); }
      to { opacity: 0; transform: translate(-50%, -50px); }
    }

    /* Styles for the new copyright section */
    .copyright {
      text-align: center;
      margin-top: 25px;
      padding: 15px;
      color: var(--text-muted);
      font-size: 0.9rem;
    }


    /* --- Responsive Adjustments --- */
    @media (max-width: 768px) {
        .container {
            padding: 30px;
        }
        h2 {
            font-size: 1.7rem;
        }
        .copyright {
            padding: 10px;
            font-size: 0.8rem;
        }
    }

    @media (max-width: 600px) {
      .container {
        padding: 25px;
        margin: 15px;
        box-shadow: var(--shadow-elevation-1); /* Lighter shadow on small screens */
      }

      h2 {
        font-size: 1.5rem;
        margin-bottom: 25px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        font-size: 0.9rem;
        top: 12px;
      }

      input:focus + label,
      select:focus + label,
      input:not(:placeholder-shown) + label,
      select:not(:placeholder-shown) + label,
      input.has-value + label, /* Added for pre-filled or readonly fields */
      select.has-value + label { /* Added for pre-filled or readonly fields */
        top: -8px;
        left: 8px;
        font-size: 0.75rem;
      }

      input, select {
        padding: 12px;
        font-size: 0.95rem;
      }

      select {
        background-position: right 12px center;
        padding-right: 35px;
      }

      .button-group {
        flex-direction: column;
        gap: 12px;
        margin-top: 25px;
      }

      .button-group button,
      .button-group a {
        padding: 12px 15px;
        font-size: 0.95rem;
      }

      .button-group i {
        margin-right: 8px;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border-width: 6px;
      }
    }

    @media (max-width: 400px) {
      .container {
        padding: 20px;
      }

      h2 {
        font-size: 1.3rem;
      }

      input, select {
        padding: 10px;
      }

      .button-group button,
      .button-group a {
        padding: 10px;
        font-size: 0.85rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Input Data Produksi</h2>
    <form id="produksiForm">
      <div class="form-group">
        <input type="date" name="Tanggal" id="tanggal" readonly required />
        <label for="tanggal">Tanggal</label>
      </div>

      <div class="form-group">
        <select name="Customer" id="customer" required>
          <option value="" disabled selected>-- Pilih Customer --</option>
        </select>
        <label for="customer">Customer</label>
      </div>

      <div class="form-group">
        <select name="Part Name" id="partName" required>
          <option value="" disabled selected>-- Pilih Part --</option>
        </select>
        <label for="partName">Part Name</label>
      </div>

      <div class="form-group">
        <input type="text" name="Part Number" id="partNumber" readonly required />
        <label for="partNumber">Part Number</label>
      </div>

      <div class="form-group">
        <select name="Status" id="status" required>
          <option value="" disabled selected>-- Pilih Status --</option>
        </select>
        <label for="status">Status</label>
      </div>

      <div class="form-group">
        <input type="number" name="Jumlah" id="jumlah" min="0" required />
        <label for="jumlah">Jumlah</label>
      </div>

      <div class="form-group">
        <select name="Satuan" id="satuan" required>
          <option value="" disabled selected>-- Pilih Satuan --</option>
        </select>
        <label for="satuan">Satuan</label>
      </div>

      <div class="form-group">
        <select name="Departement" id="departement" required>
          <option value="" disabled selected>-- Pilih Departement --</option>
        </select>
        <label for="departement">Departement</label>
      </div>

      <div class="button-group">
        <button type="submit" class="submit-btn"><i class="fas fa-paper-plane"></i> Kirim Data</button>
        <a href="dashboard.html" class="dashboard-btn"><i class="fas fa-chart-line"></i> Lihat Dashboard</a>
      </div>
    </form>

    <div class="copyright">
      <p>&copy; 2025 Form Input Produksi. <b>PT. Kenco Manufactur Indonesia</b>.</p>
    </div>
  </div>

  <div id="overlay"><div class="spinner"></div></div>
  <div id="popupNotification" class="popup-notification"><i class="fas fa-check-circle fa-lg"></i> <span></span></div>

  <script>
    const form = document.getElementById('produksiForm');
    const overlay = document.getElementById('overlay');
    const popupNotification = document.getElementById('popupNotification');

    const tanggalEl = document.getElementById("tanggal");
    const customerEl = document.getElementById("customer");
    const partNameEl = document.getElementById("partName");
    const partNumberEl = document.getElementById("partNumber");
    const statusEl = document.getElementById("status");
    const jumlahEl = document.getElementById("jumlah");
    const satuanEl = document.getElementById("satuan");
    const departementEl = document.getElementById("departement");

    const API_BASE_URL = "https://api.sheetbest.com/sheets/5c874fef-f659-4e32-aa02-8bef8583f249";
    const partList = [];
    let konversiList = [];

    // Set tanggal hari ini
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const todayString = `${yyyy}-${mm}-${dd}`;
    tanggalEl.value = todayString;
    tanggalEl.setAttribute("min", todayString); // Validasi tanggal

    // Notifikasi
    function showPopupNotification(message, type = 'success') {
      const icon = popupNotification.querySelector('i');
      const textSpan = popupNotification.querySelector('span');
      textSpan.textContent = message;
      popupNotification.className = `popup-notification ${type}`;
      icon.className = type === 'error' ? 'fas fa-times-circle fa-lg' : 'fas fa-check-circle fa-lg';
      popupNotification.classList.add('show');
      setTimeout(() => popupNotification.classList.remove('show'), 3000);
    }

    // Fetch master data
    async function fetchMasterData() {
      const [customerRes, partRes, statusRes, satuanRes, departementRes, konversiRes] = await Promise.all([
        fetch(`${API_BASE_URL}/tabs/CUSTOMER`),
        fetch(`${API_BASE_URL}/tabs/PART`),
        fetch(`${API_BASE_URL}/tabs/STATUS`),
        fetch(`${API_BASE_URL}/tabs/SATUAN`),
        fetch(`${API_BASE_URL}/tabs/DEPARTEMENT`),
        fetch(`${API_BASE_URL}/tabs/KONVERSI`)
      ]);

      const customerData = await customerRes.json();
      const partData = await partRes.json();
      const statusData = await statusRes.json();
      const satuanData = await satuanRes.json();
      const departementData = await departementRes.json();
      konversiList = await konversiRes.json();

      customerData.forEach(c => {
        if (c.Customer) {
          const opt = new Option(c.Customer, c.Customer);
          customerEl.add(opt);
        }
      });

      partData.forEach(p => {
        if (p.Customer && p["Part Name"] && p["Part No."]) {
          if (!partList[p.Customer]) partList[p.Customer] = [];
          partList[p.Customer].push({ name: p["Part Name"], number: p["Part No."] });
        }
      });

      statusData.forEach(s => {
        if (s.Status) statusEl.add(new Option(s.Status, s.Status));
      });

      satuanData.forEach(s => {
        if (s.Satuan) satuanEl.add(new Option(s.Satuan, s.Satuan));
      });

      departementData.forEach(d => {
        if (d.Departement) departementEl.add(new Option(d.Departement, d.Departement));
      });
    }

    fetchMasterData();

    customerEl.addEventListener("change", () => {
      const selected = customerEl.value;
      partNameEl.innerHTML = '<option value="" disabled selected>-- Pilih Part --</option>';
      partNumberEl.value = "";
      if (partList[selected]) {
        partList[selected].sort((a, b) => a.name.localeCompare(b.name)).forEach(part => {
          partNameEl.add(new Option(part.name, part.name));
        });
      }
    });

    partNameEl.addEventListener("change", () => {
      const selectedCustomer = customerEl.value;
      const selectedPartName = partNameEl.value;
      const part = partList[selectedCustomer]?.find(p => p.name === selectedPartName);
      partNumberEl.value = part ? part.number : "";
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      overlay.classList.add("show");

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      data.Timestamp = new Date().toISOString();

      // Konversi otomatis ke PCS
      if (data.Status === "MATERIAL" && (data.Satuan === "SHEET" || data.Satuan === "KG")) {
        const konversi = konversiList.find(k =>
          k["Customer"] === data.Customer &&
          k["Part Name"] === data["Part Name"] &&
          k["Satuan"] === data.Satuan
        );

        if (konversi && konversi["Konversi per PCS"]) {
          const jumlah = parseFloat(data.Jumlah);
          const konversiValue = parseFloat(konversi["Konversi per PCS"]);
          data["Konversi PCS"] = Math.round(jumlah * konversiValue);
        } else {
          overlay.classList.remove("show");
          showPopupNotification("Data konversi tidak ditemukan!", "error");
          return;
        }
      } else {
        data["Konversi PCS"] = "";
      }

      try {
        const res = await fetch(API_BASE_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (res.ok) {
          showPopupNotification("Data berhasil dikirim!", "success");
          form.reset();
          tanggalEl.value = todayString;
        } else {
          showPopupNotification("Gagal mengirim data.", "error");
        }
      } catch (err) {
        showPopupNotification("Terjadi kesalahan jaringan.", "error");
      } finally {
        overlay.classList.remove("show");
      }
    });
  </script>
</body>
</html>